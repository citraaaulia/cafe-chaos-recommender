{% extends 'layout.html' %}
{% block content %}

<div class="editmenu">
  <button type="button" id="back-btn">
    <img src="{{ url_for('static', filename='icons/back.svg') }}" alt="Kembali" width="20">
  </button>
  <h2>{{ menu.nama_minuman }}</h2>
</div>

<div class="form-edit-menu">
  <form method="POST" enctype="multipart/form-data" id="editMenuForm">

    <!-- Grid 2 kolom: pakai .stats-container yang sudah ada di CSS -->
    <div class="stats-container" style="align-items:flex-start; flex-wrap:wrap;">

      <!-- KOLOM KIRI -->
      <div class="col-left" style="flex:1 1 460px; min-width:360px;">

        <!-- Detail Menu -->
        <section class="form-grid">
          <h3>Detail Menu</h3>

          <label for="nama_minuman">Nama</label>
          <input name="nama_minuman" id="nama_minuman" value="{{ menu.nama_minuman or '' }}" required>

          <div class="form-group">
            <label for="categories">Kategori</label>
            <div class="dropdown-check-list single" tabindex="100">
              <span class="anchor">Pilih Kategori</span>
              <ul class="items">
                {% set selected_cats = selected_options.category_ids or [] %}
                {% for category in options.categories %}
                <li>
                  <input type="radio"
                         id="category_{{ category.id }}"
                         name="categories"
                         value="{{ category.id }}"
                         {% if category.id in selected_cats %}checked{% endif %}>
                  <label for="category_{{ category.id }}">{{ category.name }}</label>
                </li>
                {% endfor %}
                <li><a href="{{ url_for('admin.manage_options', field='categories') }}" target="_blank">+ Tambah Kategori Baru</a></li>
              </ul>
            </div>
          </div>

          <label for="harga">Harga</label>
          <input name="harga" id="harga" type="number" value="{{ menu.harga|int }}" required>

          <label>Availability</label>
          <div class="ketersediaan">
            <label class="availability">
              <input type="radio" name="availability" value="Tersedia" {% if menu.availability == 'Tersedia' %}checked{% endif %} required>
              <span>Tersedia</span>
            </label>
            <label class="availability">
              <input type="radio" name="availability" value="Habis" {% if menu.availability == 'Habis' %}checked{% endif %} required>
              <span>Habis</span>
            </label>
          </div>
        </section>

        <!-- Skor angka (short answers) -->
        <section class="form-grid">
          <h3>Profil Rasa (Skor)</h3>

          <label for="kafein_score">Kafein Score (0-1)</label>
          <input name="kafein_score" id="kafein_score" type="number" step="0.1" min="0" max="1" value="{{ menu.kafein_score }}" required>

          <label for="rasa_manis">Rasa Manis (0-1)</label>
          <input name="rasa_manis" id="rasa_manis" type="number" step="0.1" min="0" max="1" value="{{ menu.rasa_manis }}" required>

          <label for="rasa_pahit">Rasa Pahit (0-1)</label>
          <input name="rasa_pahit" id="rasa_pahit" type="number" step="0.1" min="0" max="1" value="{{ menu.rasa_pahit }}" required>

          <label for="rasa_gurih">Rasa Gurih (0-1)</label>
          <input name="rasa_gurih" id="rasa_gurih" type="number" step="0.1" min="0" max="1" value="{{ menu.rasa_gurih }}" required>

          <label for="rasa_asam">Rasa Asam (0-1)</label>
          <input name="rasa_asam" id="rasa_asam" type="number" step="0.1" min="0" max="1" value="{{ menu.rasa_asam }}" required>
        </section>

      </div>

      <!-- KOLOM KANAN -->
      <div class="col-right" style="flex:1 1 460px; min-width:360px;">

        <!-- Kriteria (select) -->
        <section class="form-grid">
          <h3>Kriteria Minuman</h3>

          <label for="temperatur_opsi">Temperatur</label>
          <select name="temperatur_opsi" id="temperatur_opsi" required>
            <option value="hot"  {% if menu.temperatur_opsi == 'hot'  %}selected{% endif %}>Hot</option>
            <option value="cold" {% if menu.temperatur_opsi == 'cold' %}selected{% endif %}>Cold</option>
            <option value="both" {% if menu.temperatur_opsi == 'both' %}selected{% endif %}>Both</option>
          </select>

          <label for="tekstur">Tekstur</label>
          <select name="tekstur" id="tekstur" required>
            <option value="tekstur_LIGHT"  {% if menu.tekstur == 'tekstur_LIGHT'  %}selected{% endif %}>Light</option>
            <option value="tekstur_CREAMY" {% if menu.tekstur == 'tekstur_CREAMY' %}selected{% endif %}>Creamy</option>
            <option value="tekstur_BUBBLY" {% if menu.tekstur == 'tekstur_BUBBLY' %}selected{% endif %}>Bubbly</option>
            <option value="tekstur_HEAVY"  {% if menu.tekstur == 'tekstur_HEAVY'  %}selected{% endif %}>Heavy</option>
          </select>

          <label for="carbonated_score">Carbonated</label>
          <select name="carbonated_score" id="carbonated_score" required>
            <option value="ya"    {% if menu.carbonated_score == 1.0 %}selected{% endif %}>Ya</option>
            <option value="tidak" {% if menu.carbonated_score == 0.0 %}selected{% endif %}>Tidak</option>
          </select>

          <label for="sweetness_level">Sweetness Level</label>
          <select name="sweetness_level" id="sweetness_level" required>
            <option value="Bitter" {% if menu.sweetness_level == 'Bitter' %}selected{% endif %}>Bitter</option>
            <option value="Low"    {% if menu.sweetness_level == 'Low'    %}selected{% endif %}>Low</option>
            <option value="Medium" {% if menu.sweetness_level == 'Medium' %}selected{% endif %}>Medium</option>
            <option value="High"   {% if menu.sweetness_level == 'High'   %}selected{% endif %}>High</option>
          </select>
        </section>

        <!-- Detail Lainnya (multi-pilih) -->
        <section class="form-grid">
          <h3>Detail Lainnya</h3>

          <div class="form-group">
            <label for="main_ingredients">Bahan Utama</label>
            <div class="dropdown-check-list" tabindex="100">
              <span class="anchor">Pilih Bahan Utama</span>
              <ul class="items">
                {% set selected_ing = selected_options.ingredient_ids or [] %}
                {% for ingredient in options.main_ingredients %}
                  <li>
                    <input type="checkbox"
                           id="main_ingredient_{{ ingredient.id }}"
                           name="main_ingredients"
                           value="{{ ingredient.id }}"
                           {% if ingredient.id in selected_ing %}checked{% endif %}>
                    <label for="main_ingredient_{{ ingredient.id }}">{{ ingredient.name }}</label>
                  </li>
                {% endfor %}
                <li><a href="{{ url_for('admin.manage_options', field='main_ingredients') }}" target="_blank">+ Tambah Bahan Utama Baru</a></li>
              </ul>
            </div>
          </div>

          <div class="form-group">
            <label for="toppings">Topping</label>
            <div class="dropdown-check-list" tabindex="100">
              <span class="anchor">Pilih Topping</span>
              <ul class="items">
                {% set selected_top = selected_options.topping_ids or [] %}
                {% for topping in options.toppings %}
                  <li>
                    <input type="checkbox"
                           id="topping_{{ topping.id }}"
                           name="toppings"
                           value="{{ topping.id }}"
                           {% if topping.id in selected_top %}checked{% endif %}>
                    <label for="topping_{{ topping.id }}">{{ topping.name }}</label>
                  </li>
                {% endfor %}
                <li><a href="{{ url_for('admin.manage_options', field='toppings') }}" target="_blank">+ Tambah Topping Baru</a></li>
              </ul>
            </div>
          </div>

          <div class="form-group">
            <label for="aromas">Aroma</label>
            <div class="dropdown-check-list" tabindex="100">
              <span class="anchor">Pilih Aroma</span>
              <ul class="items">
                {% set selected_aroma = selected_options.aroma_ids or [] %}
                {% for aroma in options.aromas %}
                  <li>
                    <input type="checkbox"
                           id="aroma_{{ aroma.id }}"
                           name="aromas"
                           value="{{ aroma.id }}"
                           {% if aroma.id in selected_aroma %}checked{% endif %}>
                    <label for="aroma_{{ aroma.id }}">{{ aroma.name }}</label>
                  </li>
                {% endfor %}
                <li><a href="{{ url_for('admin.manage_options', field='aromas') }}" target="_blank">+ Tambah Aroma Baru</a></li>
              </ul>
            </div>
          </div>

          <div class="form-group">
            <label for="flavour_notes">Flavour Notes</label>
            <div class="dropdown-check-list" tabindex="100">
              <span class="anchor">Pilih Flavour Notes</span>
              <ul class="items">
                {% set selected_fn = selected_options.flavour_note_ids or [] %}
                {% for note in options.flavour_notes %}
                  <li>
                    <input type="checkbox"
                           id="flavour_note_{{ note.id }}"
                           name="flavour_notes"
                           value="{{ note.id }}"
                           {% if note.id in selected_fn %}checked{% endif %}>
                    <label for="flavour_note_{{ note.id }}">{{ note.name }}</label>
                  </li>
                {% endfor %}
                <li><a href="{{ url_for('admin.manage_options', field='flavour_notes') }}" target="_blank">+ Tambah Flavour Note Baru</a></li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Data Pendukung (foto) -->
        <section class="form-grid">
          <h3>Data Pendukung</h3>
          <label for="foto">Ganti Foto</label>
          <input name="foto" id="foto" type="file" accept="image/*">
          {% if menu.foto %}
          <div class="current-photo">
            <p class="current-file">Foto saat ini: {{ menu.foto }}</p>
            <img src="{{ url_for('static', filename='uploads/' ~ menu.foto) }}" alt="Foto saat ini" width="100">
          </div>
          {% endif %}
        </section>

      </div>
      <!-- /KOLOM KANAN -->

    </div>

    <div class="button-wrapper">
      <button type="button" id="btn-cancel" class="btn-cancel">Cancel</button>
      <button type="button" id="btn-simpan" class="btn-simpan">Update</button>
    </div>

  </form>
</div>

<!-- Modals tetap -->
<div id="confirmationModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>Simpan Perubahan?</h3>
    <p>Apakah Anda yakin data yang diubah sudah benar?</p>
    <div class="modal-actions">
      <button onclick="closeModal()" id="modal-cancel">Tidak, Cek Lagi</button>
      <button onclick="confirmSave()" id="modal-confirm">Ya, Simpan</button>
    </div>
  </div>
</div>

<div id="discardChangesModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>Batalkan Perubahan?</h3>
    <p>Anda punya perubahan yang belum disimpan. Yakin ingin membatalkan?</p>
    <div class="modal-actions">
      <button onclick="confirmDiscard()" id="modal-confirm2">Ya, Batalkan</button>
      <button onclick="closeDiscardModal()" id="modal-cancel2">Tidak</button>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/editmenu.js') }}"></script>
{% endblock %}
